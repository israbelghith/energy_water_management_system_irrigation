<div class="pompe-container">
  <h2>Gestion des Pompes</h2>

  <div class="alert alert-error" *ngIf="error">
    {{ error }}
  </div>

  <div class="actions">
    <button class="btn btn-primary" (click)="openCreateForm()">
      <span>➕</span> Ajouter une Pompe
    </button>
  </div>

  <div class="loading" *ngIf="loading && !showForm">
    Chargement...
  </div>

  <!-- Form Modal -->
  <div class="modal" *ngIf="showForm">
    <div class="modal-content">
      <h3>{{ isEditing ? 'Modifier' : 'Créer' }} une Pompe</h3>
      <form (ngSubmit)="savePompe()">
        <div class="form-group">
          <label for="reference">Référence:</label>
          <input
            type="text"
            id="reference"
            [(ngModel)]="pompeForm.reference"
            name="reference"
            required
            placeholder="Ex: PUMP-001"
          >
        </div>

        <div class="form-group">
          <label for="puissance">Puissance (kW):</label>
          <input
            type="number"
            id="puissance"
            [(ngModel)]="pompeForm.puissance"
            name="puissance"
            required
            min="0"
            step="0.1"
          >
        </div>

        <div class="form-group">
          <label for="statut">Statut:</label>
          <select
            id="statut"
            [(ngModel)]="pompeForm.statut"
            name="statut"
            required
          >
            <option *ngFor="let statut of statutOptions" [value]="statut">
              {{ statut }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="dateMiseEnService">Date de Mise en Service:</label>
          <input
            type="date"
            id="dateMiseEnService"
            [(ngModel)]="pompeForm.dateMiseEnService"
            name="dateMiseEnService"
            required
          >
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="loading">
            {{ loading ? 'Enregistrement...' : 'Enregistrer' }}
          </button>
          <button type="button" class="btn btn-secondary" (click)="closeForm()">
            Annuler
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Pompes List -->
  <div class="pompes-grid" *ngIf="!loading || showForm">
    <div class="pompe-card" *ngFor="let pompe of pompes">
      <div class="card-header">
        <h3>{{ pompe.reference }}</h3>
        <span class="badge" [ngClass]="'badge-' + pompe.statut.toLowerCase()">
          {{ pompe.statut }}
        </span>
      </div>

      <div class="card-body">
        <p><strong>Puissance:</strong> {{ pompe.puissance }} kW</p>
        <p><strong>Date de mise en service:</strong> {{ pompe.dateMiseEnService | date:'dd/MM/yyyy' }}</p>
      </div>

      <div class="card-actions">
        <button class="btn btn-sm btn-success"
                *ngIf="pompe.statut !== 'ACTIVE'"
                (click)="activerPompe(pompe.id!)">
          Activer
        </button>
        <button class="btn btn-sm btn-warning"
                *ngIf="pompe.statut === 'ACTIVE'"
                (click)="desactiverPompe(pompe.id!)">
          Désactiver
        </button>
        <button class="btn btn-sm btn-info" (click)="openEditForm(pompe)">
          Modifier
        </button>
        <button class="btn btn-sm btn-danger" (click)="deletePompe(pompe.id!)">
          Supprimer
        </button>
      </div>
    </div>
  </div>

  <div class="no-data" *ngIf="!loading && pompes.length === 0 && !showForm">
    Aucune pompe disponible. Cliquez sur "Ajouter une Pompe" pour commencer.
  </div>
</div>
